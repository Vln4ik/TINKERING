# Tinkering dating APP(MVP)

Монорепо: **backend (FastAPI + Postgres)** и **android (Kotlin + Jetpack Compose)**.

## Что уже заложено в MVP
- **Регистрация/авторизация** (JWT)
- **Профиль**: фото (круглое на фронте), имя, пол, возраст, о себе, интересы
- **Лента**: карточки пользователей (эндпоинт под выдачу; логика ранжирования — через внешний ML/нейро сервис, подключение вынесено в конфиг)
- **Свайпы**:
  - влево: дизлайк (показываем следующего)
  - вправо: лайк → создаём чат (попадает во вкладку “Чаты”)
- **Техподдержка**: чат с ботом через **GigaChat-2-Pro**

## Interests (фиксированный список)
```
INTERESTS_LIST = [
  "music","sports","coding","movies",
  "travel","art","football","reading"
]
```

## Быстрый старт (Ubuntu сервер / локально через Docker)

1) Скопируйте env:
```bash
cp env.example .env
```

2) Заполните `.env` (важно: **не коммитьте** ключи).

3) Поднимите сервисы:
```bash
docker compose up --build -d
```

4) Проверка:
- API: `http://YOUR_SERVER:8080/docs`
- Статика (фото): `http://YOUR_SERVER:8080/static/...`

### Деплой на Ubuntu (кратко)
- Установите Docker + Compose (официальные пакеты Docker).
- Скопируйте проект на сервер.
- Создайте `.env` рядом с `docker-compose.yml` (из `env.example`) и вставьте **реальные** значения:
  - `JWT_SECRET`
  - `POSTGRES_PASSWORD`
  - `GIGACHAT_CREDENTIALS`
- Запуск: `docker compose up --build -d`

## Android

### Информация о бэкенде

**Бэкенд приложения уже развернут и работает на сервере.**

- **Адрес сервера**: `http://151.241.226.80:8080`
- **API документация**: `http://151.241.226.80:8080/docs` (Swagger UI)
- **Статические файлы**: `http://151.241.226.80:8080/static/...`

> **Важно**: Вам **не нужно** запускать бэкенд локально. Просто подключите Android приложение к серверу, указав правильный `API_BASE_URL` в настройках проекта.

**Проверка доступности сервера**:
- Откройте в браузере: `http://151.241.226.80:8080/docs` — должна открыться документация API
- Если страница не открывается, проверьте интернет-соединение или свяжитесь с администратором сервера

### Требования
- **Android Studio** (рекомендуется версия Hedgehog | 2023.1.1 или новее)
- **JDK 17** (встроен в Android Studio, но можно использовать внешний)
- **Android SDK** (устанавливается через Android Studio SDK Manager)
  - Минимальная версия: API 24 (Android 7.0)
  - Целевая версия: API 35 (Android 15)
- **Эмулятор Android** или физическое устройство для тестирования
- **Интернет-соединение** (для подключения к бэкенду на сервере)

### Пошаговая инструкция по запуску

#### 1. Открытие проекта в Android Studio

1. Запустите **Android Studio**
2. Выберите **File → Open** (или **Open an Existing Project**)
3. Перейдите в папку проекта и выберите папку **`android/`** (не корневую папку проекта!)
4. Нажмите **OK**

#### 2. Настройка Gradle JDK

При первом открытии Android Studio может попросить выбрать JDK:

1. Если появится диалог **"Gradle JDK"**:
   - Выберите **"Embedded JDK (17)"** или **"JetBrains Runtime 21"**
   - Нажмите **OK**

2. Если диалог не появился, проверьте настройки:
   - **File → Settings** (или **Android Studio → Preferences** на macOS)
   - **Build, Execution, Deployment → Build Tools → Gradle**
   - В поле **"Gradle JDK"** выберите **JDK 17** или выше

#### 3. Синхронизация проекта

1. Android Studio автоматически начнёт синхронизацию Gradle (иконка в правом нижнем углу)
2. Если синхронизация не началась автоматически:
   - Нажмите **File → Sync Project with Gradle Files**
   - Или нажмите на уведомление **"Sync Now"**

3. **Важно**: При первой синхронизации Android Studio может скачать зависимости и Gradle wrapper. Это может занять несколько минут.

#### 4. Настройка подключения к бэкенду

**Бэкенд уже развернут на сервере** `151.241.226.80:8080`. Вам нужно только убедиться, что Android приложение правильно настроено для подключения к этому серверу.

1. Откройте файл **`android/app/build.gradle.kts`**
2. Найдите строку с `API_BASE_URL`:
   ```kotlin
   buildConfigField("String", "API_BASE_URL", "\"http://151.241.226.80:8080\"")
   ```
3. **Проверьте, что адрес указан правильно**:
   - По умолчанию уже установлен адрес сервера: `http://151.241.226.80:8080`
   - **Не меняйте этот адрес**, если только не нужно подключиться к другому серверу
4. Сохраните файл и выполните **Sync Project with Gradle Files** снова

> **Примечание**: Если вы хотите запустить бэкенд локально (для разработки), измените адрес на:
> - Для эмулятора: `http://10.0.2.2:8080`
> - Для физического устройства: `http://YOUR_COMPUTER_IP:8080`

#### 5. Создание эмулятора (если нет физического устройства)

1. Нажмите **Tools → Device Manager** (или иконку телефона в правом верхнем углу)
2. Нажмите **Create Device**
3. Выберите устройство (например, **Pixel 6**)
4. Нажмите **Next**
5. Выберите системный образ (рекомендуется **API 34** или **API 35**)
   - Если образа нет, нажмите **Download** рядом с нужным образом
6. Нажмите **Next** → **Finish**

#### 6. Запуск приложения

1. Убедитесь, что эмулятор запущен или устройство подключено:
   - Проверьте список устройств в верхней панели Android Studio
   - Если эмулятор не запущен, запустите его из **Device Manager**

2. Выберите конфигурацию запуска:
   - В верхней панели выберите **"app"** в выпадающем списке конфигураций
   - Убедитесь, что выбран правильный **device/emulator**

3. Нажмите кнопку **▶ Run** (зелёная кнопка "Run" в верхней панели)
   - Или используйте горячую клавишу: **Shift + F10** (Windows/Linux) или **Ctrl + R** (macOS)

4. Приложение скомпилируется и установится на устройство/эмулятор

#### 7. Проверка работы

После запуска приложения:

1. **Первый запуск**: Откроется экран регистрации
   - Заполните все поля (фото, имя, пол, возраст, о себе, выберите интересы)
   - Нажмите **"Зарегистрироваться"**

2. **После регистрации**: Вы попадёте в главный экран с тремя вкладками:
   - **Лента** (центральная): карточки пользователей для свайпов
   - **Чаты** (слева): список диалогов и техподдержка
   - **Настройки** (справа): редактирование профиля

3. **Проверка подключения к бэкенду**:
   - Приложение автоматически подключится к бэкенду на сервере `151.241.226.80:8080`
   - Если при регистрации появляется ошибка подключения:
     - Проверьте интернет-соединение на устройстве/эмуляторе
     - Убедитесь, что `API_BASE_URL` в `build.gradle.kts` установлен как `http://151.241.226.80:8080`
     - Проверьте, что сервер доступен: откройте в браузере `http://151.241.226.80:8080/docs` (должна открыться документация API)

### Решение проблем

#### Ошибка: "Gradle sync failed"
- Проверьте, что выбран правильный JDK (17+)
- Попробуйте **File → Invalidate Caches → Invalidate and Restart**
- Убедитесь, что у вас есть интернет-соединение (Gradle скачивает зависимости)

#### Ошибка: "Cannot find a Java installation"
- Откройте **File → Settings → Build Tools → Gradle**
- В поле **"Gradle JDK"** выберите **"Embedded JDK (17)"**

#### Ошибка: "AAR metadata requires compileSdk 35"
- Убедитесь, что в `android/app/build.gradle.kts` установлены:
  ```kotlin
  compileSdk = 35
  targetSdk = 35
  ```

#### Ошибка подключения к API
- **Проверьте интернет-соединение** на устройстве/эмуляторе
- Убедитесь, что `API_BASE_URL` в `android/app/build.gradle.kts` установлен как `http://151.241.226.80:8080`
- Проверьте доступность сервера: откройте в браузере `http://151.241.226.80:8080/docs`
- Если используете эмулятор, убедитесь, что он имеет доступ в интернет (проверьте настройки сети эмулятора)
- Для физического устройства убедитесь, что устройство подключено к Wi-Fi или мобильному интернету

#### Приложение не запускается на эмуляторе
- Убедитесь, что эмулятор полностью загрузился (дождитесь появления домашнего экрана)
- Попробуйте перезапустить эмулятор: **Device Manager → Actions → Cold Boot Now**

### Структура проекта

```
android/
├── app/
│   ├── src/
│   │   └── main/
│   │       ├── java/com/tinkering/twinby/
│   │       │   ├── data/          # API клиент, модели, репозиторий
│   │       │   ├── ui/
│   │       │   │   ├── screens/   # Экраны приложения
│   │       │   │   ├── glass/     # UI компоненты "Liquid Glass"
│   │       │   │   └── theme/     # Тема приложения
│   │       │   └── MainActivity.kt
│   │       └── res/               # Ресурсы (иконки, строки и т.д.)
│   └── build.gradle.kts           # Конфигурация приложения (API_BASE_URL здесь!)
├── build.gradle.kts               # Корневой build файл
├── settings.gradle.kts
└── gradle/                         # Gradle wrapper
```

### Дополнительные настройки

#### Изменение API адреса без пересборки (для разработки)

Если нужно быстро переключиться между разными серверами, можно использовать **Build Variants**:

1. Откройте **Build → Select Build Variant**
2. Выберите нужный вариант (debug/release)
3. В `build.gradle.kts` можно создать разные конфигурации для разных вариантов

#### Логирование и отладка

- **Logcat**: В Android Studio откройте вкладку **Logcat** внизу экрана для просмотра логов приложения
- **Breakpoints**: Установите точки останова в коде для отладки
- **Network Inspector**: **View → Tool Windows → App Inspection** для мониторинга сетевых запросов

## API маршруты (для фронта)
- **POST** `/auth/register` (multipart): `login,password,name,gender,age,about,interests(csv),photo`
- **POST** `/auth/login` (json): `{login,password}`
- **GET** `/me` (bearer)
- **PUT** `/me` (multipart, все поля опциональны)
- **GET** `/feed?limit=20` (bearer)
- **POST** `/swipe` (bearer): `{target_user_id, direction(left|right)}` → `{created_chat_id?}`
- **GET** `/chats` (bearer)
- **GET** `/chats/{chatId}/messages` (bearer)
- **POST** `/chats/{chatId}/messages` (bearer): `{text}`
- **GET** `/support/messages` (bearer)
- **POST** `/support/messages` (bearer): `{text}` → ответ техподдержки через GigaChat

## Важно про креды GigaChat
Ключи/токены **никогда не хардкодим в коде** — только через переменные окружения на сервере (`.env` / systemd / docker secrets).


